<div class="fixed inset-0 z-100 flex justify-end pointer-events-none"
    [class.pointer-events-none]="!cartService.isOpen()">
    <!-- Fondo (Backdrop) -->
    <div class="fixed inset-0 bg-black/60 transition-opacity duration-300 ease-in-out"
        [class.opacity-0]="!cartService.isOpen()" [class.pointer-events-none]="!cartService.isOpen()" (click)="close()">
    </div>
    <!-- Barra Lateral -->
    <div class="relative h-full w-full max-w-md bg-neutral-900 border-l border-blue-900 shadow-2xl flex flex-col transition-transform duration-500 ease-in-out transform"
        [class.translate-x-full]="!cartService.isOpen()">
        <!-- Encabezado -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-neutral-800 bg-neutral-900 z-10">
            <h2 class="text-2xl font-bold text-white tracking-tight">Tu Carrito</h2>
            <button (click)="close()"
                class="p-2 rounded-full text-neutral-400 hover:text-white hover:bg-neutral-800 transition"
                aria-label="Cerrar carrito" title="Cerrar carrito">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <!-- Contenido -->
        <div class="flex-1 overflow-y-auto px-6 py-4 bg-neutral-900">
            @if (cartService.items().length === 0) {
            <div class="flex flex-col items-center justify-center h-full text-center py-16">
                <div class="mb-4 flex items-center justify-center w-20 h-20 rounded-full bg-neutral-800">
                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                        class="text-neutral-500">
                        <circle cx="8" cy="21" r="1" />
                        <circle cx="19" cy="21" r="1" />
                        <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12" />
                        <path d="M16 10a4 4 0 0 1-8 0" />
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-white mb-2">Tu carrito está vacío</h3>
                <p class="text-neutral-400 mb-8 max-w-xs mx-auto">¡Empieza a agregar productos increíbles!</p>
                <button (click)="close()" routerLink="/products"
                    class="px-6 py-2 bg-blue-900 text-white rounded-lg font-bold shadow hover:bg-blue-800 transition">Ir
                    a la Tienda</button>
            </div>
            } @else {
            <div class="space-y-4">
                @for (item of cartService.items(); track item.product.id) {
                <div
                    class="flex gap-4 p-4 bg-neutral-800 rounded-xl border border-neutral-700 hover:shadow-lg transition">
                    <div
                        class="w-20 h-20 bg-linear-to-br from-slate-700 to-slate-800 rounded-lg flex items-center justify-center overflow-hidden border border-slate-600">
                        @if (item.product.imageUrl && item.product.imageUrl.trim() !== '') {
                        <img [src]="item.product.imageUrl" [alt]="item.product.name || 'Imagen del producto'"
                            [attr.title]="item.product.name || 'Imagen del producto'" class="sidebar-item-image"
                            onerror="this.style.display='none'">
                        }
                        @if (!item.product.imageUrl || item.product.imageUrl.trim() === '') {
                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                            class="text-slate-500 opacity-50">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                            <circle cx="8.5" cy="8.5" r="1.5" />
                            <polyline points="21 15 16 10 5 21" />
                        </svg>
                        }
                    </div>
                    <div class="flex-1 min-w-0">
                        <h4 class="font-bold text-white text-sm line-clamp-2 mb-1 leading-snug">{{ item.product.name }}
                        </h4>
                        <p class="text-blue-300 font-bold text-sm mb-3">{{ item.product.price | priceFormat }}</p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center border border-neutral-700 rounded-lg bg-neutral-900">
                                <button (click)="decrementQuantity(item.product.id)"
                                    class="w-8 h-8 flex items-center justify-center text-blue-400 hover:text-white disabled:text-neutral-700 transition"
                                    [disabled]="item.quantity<=1">-</button>
                                <span class="w-8 text-center text-sm font-semibold text-white">{{ item.quantity
                                    }}</span>
                                <button (click)="incrementQuantity(item.product.id)"
                                    class="w-8 h-8 flex items-center justify-center text-blue-400 hover:text-white transition">+</button>
                            </div>
                            <button (click)="cartService.updateQuantity(item.product.id, 0, true)"
                                class="text-xs text-red-400 hover:text-red-300 underline ml-2">Eliminar</button>
                        </div>
                    </div>
                </div>
                }
            </div>
            }
        </div>
        <!-- Pie de página -->
        @if (cartService.items().length > 0) {
        <div class="px-6 py-4 border-t border-neutral-800 bg-neutral-900 z-10">
            <div class="flex justify-between items-end mb-6">
                <span class="text-neutral-400 font-medium">Subtotal</span>
                <span class="text-2xl font-bold text-white">{{ cartService.total() | priceFormat }}</span>
            </div>
            <button (click)="goToCheckout()"
                class="w-full py-3 bg-blue-900 text-white rounded-xl font-bold shadow hover:bg-blue-800 transition flex items-center justify-center gap-2">
                <span>Proceder al Pago</span>
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                    <polyline points="12 5 19 12 12 19"></polyline>
                </svg>
            </button>
        </div>
        }
    </div>
</div>